<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CustomToken - Technical Reference</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Technical Reference</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/agglayer/vault-bridge" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="customtoken"><a class="header" href="#customtoken">CustomToken</a></h1>
<p><a href="https://github.com/agglayer/vault-bridge/blob/2c76a3249f25aa635aad39bd435c00f1c4cfe601/src/CustomToken.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, AccessControlUpgradeable, PausableUpgradeable, ReentrancyGuardUpgradeable, ERC20PermitUpgradeable, <a href="/src/etc/Versioned.sol/abstract.Versioned.html">Versioned</a></p>
<p><strong>Author:</strong>
See https://github.com/agglayer/vault-bridge</p>
<p>A Custom Token is an optional ERC-20 token on Layer Ys to represent the 'native' version of the original underlying token from Layer X on Layer Y, ideally (or, simply, the upgraded version of the bridged vbToken).</p>
<p><em>A base contract used to create Custom Tokens.</em></p>
<p><em>@note IMPORTANT: Custom Token MUST be used as the new implementation for the bridged vbToken or be custom mapped to the corresponding vbToken on LxLy Bridge on Layer Y, and MUST give the minting and burning permission to LxLy Bridge and Native Converter. It MAY have a transfer fee.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="_custom_token_storage"><a class="header" href="#_custom_token_storage">_CUSTOM_TOKEN_STORAGE</a></h3>
<p><em>The storage slot at which Custom Token storage starts, following the EIP-7201 standard.</em></p>
<p><em>Calculated as <code>keccak256(abi.encode(uint256(keccak256("agglayer.vault-bridge.CustomToken.storage")) - 1)) &amp; ~bytes32(uint256(0xff))</code>.</em></p>
<pre><code class="language-solidity">bytes32 private constant _CUSTOM_TOKEN_STORAGE = hex"0300d81ec8b5c42d6bd2cedd81ce26f1003c52753656b7512a8eef168b702500";
</code></pre>
<h3 id="pauser_role"><a class="header" href="#pauser_role">PAUSER_ROLE</a></h3>
<pre><code class="language-solidity">bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE");
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="onlylxlybridgeandnativeconverter"><a class="header" href="#onlylxlybridgeandnativeconverter">onlyLxlyBridgeAndNativeConverter</a></h3>
<p><em>Checks if the sender is LxLy Bridge or Native Converter.</em></p>
<p><em>This modifier is used to restrict the minting and burning of Custom Token.</em></p>
<pre><code class="language-solidity">modifier onlyLxlyBridgeAndNativeConverter();
</code></pre>
<h3 id="__customtoken_init"><a class="header" href="#__customtoken_init">__CustomToken_init</a></h3>
<p><em>Preserves the <code>name</code> and <code>symbol</code> of the bridged vbToken.</em></p>
<pre><code class="language-solidity">function __CustomToken_init(
    address owner_,
    uint8 originalUnderlyingTokenDecimals_,
    address lxlyBridge_,
    address nativeConverter_
) internal onlyInitializing;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>originalUnderlyingTokenDecimals_</code></td><td><code>uint8</code></td><td>The number of decimals of the original underlying token on Layer X. Custom Token will have the same number of decimals as the original underlying token.</td></tr>
<tr><td><code>lxlyBridge_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>nativeConverter_</code></td><td><code>address</code></td><td>The address of Native Converter for this Custom Token.</td></tr>
</tbody></table>
</div>
<h3 id="decimals"><a class="header" href="#decimals">decimals</a></h3>
<p>The number of decimals of Custom Token.</p>
<p>The number of decimals is the same as that of the original underlying token on Layer X.</p>
<pre><code class="language-solidity">function decimals() public view override returns (uint8);
</code></pre>
<h3 id="lxlybridge"><a class="header" href="#lxlybridge">lxlyBridge</a></h3>
<p>LxLy Bridge, which connects AggLayer networks.</p>
<pre><code class="language-solidity">function lxlyBridge() public view returns (address);
</code></pre>
<h3 id="nativeconverter"><a class="header" href="#nativeconverter">nativeConverter</a></h3>
<p>The address of Native Converter for this Custom Token.</p>
<pre><code class="language-solidity">function nativeConverter() public view returns (address);
</code></pre>
<h3 id="_getcustomtokenstorage"><a class="header" href="#_getcustomtokenstorage">_getCustomTokenStorage</a></h3>
<p><em>Returns a pointer to the ERC-7201 storage namespace.</em></p>
<pre><code class="language-solidity">function _getCustomTokenStorage() private pure returns (CustomTokenStorage storage $);
</code></pre>
<h3 id="transfer"><a class="header" href="#transfer">transfer</a></h3>
<p><em>Pausable ERC-20 <code>transfer</code> function.</em></p>
<pre><code class="language-solidity">function transfer(address to, uint256 value) public override whenNotPaused returns (bool);
</code></pre>
<h3 id="transferfrom"><a class="header" href="#transferfrom">transferFrom</a></h3>
<p><em>Pausable ERC-20 <code>transferFrom</code> function.</em></p>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 value) public override whenNotPaused returns (bool);
</code></pre>
<h3 id="approve"><a class="header" href="#approve">approve</a></h3>
<p><em>Pausable ERC-20 <code>approve</code> function.</em></p>
<pre><code class="language-solidity">function approve(address spender, uint256 value) public override whenNotPaused returns (bool);
</code></pre>
<h3 id="permit"><a class="header" href="#permit">permit</a></h3>
<p><em>Pausable ERC-20 Permit <code>permit</code> function.</em></p>
<pre><code class="language-solidity">function permit(address owner, address spender, uint256 value, uint256 deadline, uint8 v, bytes32 r, bytes32 s)
    public
    override
    whenNotPaused;
</code></pre>
<h3 id="mint"><a class="header" href="#mint">mint</a></h3>
<p>Mints Custom Tokens to the recipient.</p>
<p>This function can be called by LxLy Bridge and Native Converter only.</p>
<pre><code class="language-solidity">function mint(address account, uint256 value) external whenNotPaused onlyLxlyBridgeAndNativeConverter nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>account</code></td><td><code>address</code></td><td>@note CAUTION! Minting to <code>address(0)</code> will result in no tokens minted! This is to enable vbToken on Layer X to bridge tokens to address zero on Layer Y at the end of the process of migrating backing from Native Converter to Layer X. Please refer to <code>NativeConverter.sol</code> for more information.</td></tr>
<tr><td><code>value</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="burn"><a class="header" href="#burn">burn</a></h3>
<p>Burns Custom Tokens from a holder.</p>
<p>This function can be called by LxLy Bridge and Native Converter only.</p>
<pre><code class="language-solidity">function burn(address account, uint256 value) external whenNotPaused onlyLxlyBridgeAndNativeConverter nonReentrant;
</code></pre>
<h3 id="pause"><a class="header" href="#pause">pause</a></h3>
<p>Prevents usage of functions with the <code>whenNotPaused</code> modifier.</p>
<p>This function can be called by a pauser only.</p>
<pre><code class="language-solidity">function pause() external onlyRole(PAUSER_ROLE) nonReentrant;
</code></pre>
<h3 id="unpause"><a class="header" href="#unpause">unpause</a></h3>
<p>Allows usage of functions with the <code>whenNotPaused</code> modifier.</p>
<p>This function can be called by the owner only.</p>
<pre><code class="language-solidity">function unpause() external onlyRole(DEFAULT_ADMIN_ROLE) nonReentrant;
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="notminted"><a class="header" href="#notminted">NotMinted</a></h3>
<pre><code class="language-solidity">event NotMinted(uint256 indexed value);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="unauthorized"><a class="header" href="#unauthorized">Unauthorized</a></h3>
<pre><code class="language-solidity">error Unauthorized();
</code></pre>
<h3 id="invalidowner"><a class="header" href="#invalidowner">InvalidOwner</a></h3>
<pre><code class="language-solidity">error InvalidOwner();
</code></pre>
<h3 id="invalidoriginalunderlyingtokendecimals"><a class="header" href="#invalidoriginalunderlyingtokendecimals">InvalidOriginalUnderlyingTokenDecimals</a></h3>
<pre><code class="language-solidity">error InvalidOriginalUnderlyingTokenDecimals();
</code></pre>
<h3 id="invalidlxlybridge"><a class="header" href="#invalidlxlybridge">InvalidLxLyBridge</a></h3>
<pre><code class="language-solidity">error InvalidLxLyBridge();
</code></pre>
<h3 id="invalidnativeconverter"><a class="header" href="#invalidnativeconverter">InvalidNativeConverter</a></h3>
<pre><code class="language-solidity">error InvalidNativeConverter();
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="customtokenstorage"><a class="header" href="#customtokenstorage">CustomTokenStorage</a></h3>
<p><em>Storage of Custom Token contract.</em></p>
<p><em>It's implemented on a custom ERC-7201 namespace to reduce the risk of storage collisions when using with upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:agglayer.vault-bridge.CustomToken.storage</p>
<pre><code class="language-solidity">struct CustomTokenStorage {
    uint8 decimals;
    address lxlyBridge;
    address nativeConverter;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/vault-bridge-tokens/GenericVaultBridgeToken.sol/contract.GenericVaultBridgeToken.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../src/MigrationManager.sol/contract.MigrationManager.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/vault-bridge-tokens/GenericVaultBridgeToken.sol/contract.GenericVaultBridgeToken.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../src/MigrationManager.sol/contract.MigrationManager.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>


    </div>
    </body>
</html>
